{"ast":null,"code":"import _regeneratorRuntime from \"E:/src/next/sistemas/idpb-app/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"E:/src/next/sistemas/idpb-app/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport aws from 'aws-sdk';\nvar bucketName = 'sistemaidpb';\naws.config.update({\n  secretAccessKey: process.env.AWSSECRET_KEY,\n  accessKeyId: process.env.AWSACCESS_KEY,\n  region: process.env.AWSREGION\n});\nvar s3 = new aws.S3();\nexport function uploadVideosS3(_x) {\n  return _uploadVideosS.apply(this, arguments);\n}\n\nfunction _uploadVideosS() {\n  _uploadVideosS = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(fileName) {\n    var params, headCode, signedUrl, uploadURL, urls;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            params = {\n              Bucket: bucketName,\n              Key: fileName\n            }; // Using async/await (untested)\n\n            _context.prev = 1;\n            _context.next = 4;\n            return s3.headObject(params).promise();\n\n          case 4:\n            headCode = _context.sent;\n            signedUrl = s3.getSignedUrlPromise('getObject', params); // Do something with signedUrl\n\n            _context.next = 11;\n            break;\n\n          case 8:\n            _context.prev = 8;\n            _context.t0 = _context[\"catch\"](1);\n\n            if (_context.t0.code === 'NotFound') {// Handle no object on cloud here\n            }\n\n          case 11:\n            _context.prev = 11;\n            _context.next = 14;\n            return s3.headObject(params).promise();\n\n          case 14:\n            uploadURL = _context.sent;\n            // getSignedUrlPromise('getObject', params); // s3.getSignedUrlPromise('putObject', params);\n            urls = uploadURL; //    console.log(urls);\n\n            return _context.abrupt(\"return\", urls);\n\n          case 19:\n            _context.prev = 19;\n            _context.t1 = _context[\"catch\"](11);\n            throw new Error(\"Could not retrieve file from S3: \".concat(_context.t1.message));\n\n          case 22:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[1, 8], [11, 19]]);\n  }));\n  return _uploadVideosS.apply(this, arguments);\n}\n\nexport default uploadVideosS3;","map":{"version":3,"sources":["E:/src/next/sistemas/idpb-app/src/utils/uploadImagensS3.js"],"names":["aws","bucketName","config","update","secretAccessKey","process","env","AWSSECRET_KEY","accessKeyId","AWSACCESS_KEY","region","AWSREGION","s3","S3","uploadVideosS3","fileName","params","Bucket","Key","headObject","promise","headCode","signedUrl","getSignedUrlPromise","code","uploadURL","urls","Error","message"],"mappings":";;AAAA,OAAOA,GAAP,MAAgB,SAAhB;AAEA,IAAMC,UAAU,GAAG,aAAnB;AAEAD,GAAG,CAACE,MAAJ,CAAWC,MAAX,CAAkB;AAChBC,EAAAA,eAAe,EAAEC,OAAO,CAACC,GAAR,CAAYC,aADb;AAEhBC,EAAAA,WAAW,EAAEH,OAAO,CAACC,GAAR,CAAYG,aAFT;AAGhBC,EAAAA,MAAM,EAAEL,OAAO,CAACC,GAAR,CAAYK;AAHJ,CAAlB;AAMA,IAAMC,EAAE,GAAG,IAAIZ,GAAG,CAACa,EAAR,EAAX;AAEA,gBAAsBC,cAAtB;AAAA;AAAA;;;4EAAO,iBAA8BC,QAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AACCC,YAAAA,MADD,GACU;AACbC,cAAAA,MAAM,EAAEhB,UADK;AAEbiB,cAAAA,GAAG,EAAEH;AAFQ,aADV,EAKL;;AALK;AAAA;AAAA,mBAOoBH,EAAE,CAACO,UAAH,CAAcH,MAAd,EAAsBI,OAAtB,EAPpB;;AAAA;AAOGC,YAAAA,QAPH;AAQGC,YAAAA,SARH,GAQeV,EAAE,CAACW,mBAAH,CAAuB,WAAvB,EAAoCP,MAApC,CARf,EASH;;AATG;AAAA;;AAAA;AAAA;AAAA;;AAWH,gBAAI,YAAQQ,IAAR,KAAiB,UAArB,EAAiC,CAC/B;AACD;;AAbE;AAAA;AAAA;AAAA,mBAmBqBZ,EAAE,CAACO,UAAH,CAAcH,MAAd,EAAsBI,OAAtB,EAnBrB;;AAAA;AAmBGK,YAAAA,SAnBH;AAoBH;AACMC,YAAAA,IArBH,GAqBUD,SArBV,EAsBH;;AAtBG,6CAuBIC,IAvBJ;;AAAA;AAAA;AAAA;AAAA,kBA0BG,IAAIC,KAAJ,4CAA8C,YAAEC,OAAhD,EA1BH;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AA8BP,eAAed,cAAf","sourcesContent":["import aws from 'aws-sdk';\r\n\r\nconst bucketName = 'sistemaidpb';\r\n\r\naws.config.update({\r\n  secretAccessKey: process.env.AWSSECRET_KEY,\r\n  accessKeyId: process.env.AWSACCESS_KEY,\r\n  region: process.env.AWSREGION,\r\n});\r\n\r\nconst s3 = new aws.S3();\r\n\r\nexport async function uploadVideosS3(fileName) {\r\n  const params = {\r\n    Bucket: bucketName,\r\n    Key: fileName,\r\n  };\r\n  // Using async/await (untested)\r\n  try {\r\n    const headCode = await s3.headObject(params).promise();\r\n    const signedUrl = s3.getSignedUrlPromise('getObject', params);\r\n    // Do something with signedUrl\r\n  } catch (headErr) {\r\n    if (headErr.code === 'NotFound') {\r\n      // Handle no object on cloud here\r\n    }\r\n  }\r\n  try {\r\n    // const url2 = await presigner.presign(new HttpRequest(s3ObjectUrl));\r\n    // console.log('PRESIGNED URL: ', formatUrl(url2));\r\n    // const uploadURL = await s3.getObject(params).promise();\r\n    const uploadURL = await s3.headObject(params).promise();\r\n    // getSignedUrlPromise('getObject', params); // s3.getSignedUrlPromise('putObject', params);\r\n    const urls = uploadURL;\r\n    //    console.log(urls);\r\n    return urls;\r\n    // return valorUrl;\r\n  } catch (e) {\r\n    throw new Error(`Could not retrieve file from S3: ${e.message}`);\r\n  }\r\n}\r\n\r\nexport default uploadVideosS3;\r\n"]},"metadata":{},"sourceType":"module"}