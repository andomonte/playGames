{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport { lightGreen, yellow, red, blue } from '@material-ui/core/colors';\nimport axios from 'axios';\nimport api from 'src/components/services/api';\nimport TouchAppIcon from '@material-ui/icons/TouchApp';\nimport { useSession, signOut } from 'next-auth/client';\nimport useSWR from 'swr';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport React, { useCallback, useEffect } from 'react';\nimport CancelIcon from '@material-ui/icons/Cancel'; // import { signOut } from 'next-auth/client';\n\nimport { Box, Button, Modal } from '@material-ui/core';\nimport Dropzone, { useDropzone } from 'react-dropzone';\nimport styled, { css } from 'styled-components';\nimport DeleteForeverIcon from '@material-ui/icons/DeleteForever';\nimport { uniqueId } from 'lodash';\nimport filesize from 'filesize';\nimport { CircularProgressbar } from 'react-circular-progressbar';\nimport { MdCheckCircle, MdError, MdLink } from 'react-icons/md';\nimport ImageSearchIcon from '@material-ui/icons/ImageSearch';\nimport CheckCircleIcon from '@material-ui/icons/CheckCircle';\nimport Alert from '@material-ui/lab/Alert';\nimport Typography from '@material-ui/core/Typography'; // import JsFileDownloader from 'js-file-downloader';\n\nimport { Container, FileInfo, Preview } from './styles';\nimport 'react-circular-progressbar/dist/styles.css'; // const download = require('image-downloader');\n\nconst dragActive = css`\n  border-color: #76ff03;\n`;\nconst dragReject = css`\n  border-color: #ff5722;\n`;\nconst DropContainer = styled.div.attrs({\n  className: 'dropzone'\n})`\n  border: 3px dashed #ddd;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: height 0.2s ease;\n\n  ${props => props.isDragActive && dragActive}\n  ${props => props.isDragReject && dragReject}\n`;\nconst UploadMessage = styled.p`\n  display: flex;\n  flex-direction: column;\n  color: #000;\n  justify-content: center;\n  align-items: center;\n  padding: 15px 0;\n`; //----------------------------------------------------------------\n\nconst fetcher = url => axios.get(url).then(res => res.data); // const fetcher = (url) => fetch(url).then((r) => r.json());\n\n\nconst useStyles = makeStyles(theme => ({\n  boxUp: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    height: '100%'\n  },\n  boxInterno: {\n    width: '100%',\n    maxWidth: '400px',\n    margin: '3px',\n    background: '#fff',\n    borderRadius: '4px',\n    padding: '20px'\n  },\n  boxImage: {\n    width: '100%',\n    maxWidth: '600px',\n    maxHeight: '400',\n    margin: '3px',\n    background: '#fff',\n    borderRadius: '4px',\n    padding: '20px'\n  },\n  qtyLetras: {\n    maxWidth: '150px',\n    // Limite maximo do texto\n    whitespace: 'nowrap',\n    // Removendo quebra de linha\n    overflow: 'hidden',\n    // Removendo a barra de rolagem\n    textoverflow: 'ellipsis' // Adicionando \"...\" ao final do texto\n\n  },\n  dragMessage: {\n    width: '100%',\n    maxWidth: '400px',\n    margin: '30px',\n    background: '#bcaaa4',\n    borderRadius: '4px',\n    padding: '20px'\n  },\n  root: {\n    flexGrow: 1,\n    alignContent: 'center'\n  },\n  buttonCancel: {\n    alignContent: 'center',\n    // color: theme.palette.background.primary,\n    color: theme.palette.getContrastText(red[500]),\n    backgroundColor: red[500],\n    '&:hover': {\n      backgroundColor: red[700]\n    }\n  },\n  buttonVoltar: {\n    alignContent: 'center',\n    // color: theme.palette.background.primary,\n    color: theme.palette.getContrastText(yellow[500]),\n    backgroundColor: yellow[500],\n    '&:hover': {\n      backgroundColor: yellow[700]\n    }\n  },\n  buttonSalvar: {\n    alignContent: 'center',\n    // color: theme.palette.background.primary,\n    color: theme.palette.getContrastText(blue[500]),\n    backgroundColor: blue[500],\n    '&:hover': {\n      backgroundColor: blue[700]\n    }\n  },\n  buttonGreen: {\n    alignContent: 'center',\n    // color: theme.palette.background.primary,\n    color: theme.palette.getContrastText(lightGreen.A400),\n    backgroundColor: lightGreen.A400,\n    '&:hover': {\n      backgroundColor: lightGreen.A700\n    }\n  },\n  button: {\n    alignContent: 'center'\n  },\n  box: {\n    display: 'flex',\n    justifyContent: 'center',\n    marginTop: 0,\n    '& > *': {\n      margin: theme.spacing(2) // width: '50ch',\n\n    }\n  },\n  novoBox: {\n    flexGrow: 1,\n    padding: theme.spacing(1),\n    textAlign: 'center',\n    color: theme.palette.text.secondary\n  },\n  tf_12: {\n    // marginLeft: theme.spacing(1),\n    //  marginRight: theme.spacing(1),\n    width: '500px',\n    margin: 10,\n    [theme.breakpoints.down('md')]: {\n      width: '20'\n    }\n  },\n  tf_m: {\n    width: '100%',\n    fontSize: '5px'\n  },\n  tf_6: {\n    //    marginRight: 8,\n    margin: 10,\n    width: '240px',\n    textAlign: 'center',\n    // alignItems: 'center',\n    [theme.breakpoints.down('md')]: {\n      margin: 10,\n      width: '205px'\n    }\n  },\n  tf_4: {\n    margin: 10,\n    // marginRight: 8,\n    width: '155px',\n    textAlign: 'center',\n    // alignItems: 'center',\n    [theme.breakpoints.down('md')]: {\n      marginLeft: 10,\n      width: '130px'\n    }\n  },\n  tf_3: {\n    margin: 10,\n    textAlign: 'center',\n    // marginRight: 8,\n    width: '120px',\n    // alignItems: 'center',\n    [theme.breakpoints.down('md')]: {\n      marginLeft: 10,\n      width: '110px'\n    }\n  },\n  buttonProgress: {\n    color: lightGreen[500],\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    marginTop: -12,\n    marginLeft: -12\n  }\n}));\n\nfunction enviar({\n  item\n}) {\n  const DataAtual = new Date();\n  let month = Number(DataAtual.getMonth() + 1);\n  if (month < 10) month = `0${month}`;\n  const Data = `${DataAtual.getDate()}/${month}/${DataAtual.getFullYear()}`;\n  const classes = useStyles();\n  const [open, setOpen] = React.useState(false);\n  const [send, setSend] = React.useState(false);\n  const [transfer, setTransfer] = React.useState('');\n  const [fileObjects, setFileObjects] = React.useState([]);\n  const [contagem, setContagem] = React.useState([]);\n  const dataEvento = String(Data.split('/').join('')); // retira a / da data\n\n  const arrayFinal = [];\n  const [session] = useSession();\n  const [editar, setEditar] = React.useState();\n  const [progresso, setProgresso] = React.useState(0);\n  const [seconds, setSeconds] = React.useState(0);\n  const [loading, setLoading] = React.useState(false);\n  const arraytoSend = []; //----------------------------------------------------------------------\n\n  const url = `${window.location.origin}/api/consultaEventos/${item[0].codigoIgreja}/${dataEvento}`;\n  useEffect(() => {\n    if (fileObjects.length > 0) setSend(true);else setSend(false);\n\n    if (fileObjects.length > 0) {\n      for (let i = 0; i < 2; i += 1) {\n        if (fileObjects[i]) arraytoSend[i] = fileObjects[i];\n      }\n\n      if (arraytoSend) setFileObjects(arraytoSend);\n    }\n  }, [contagem]);\n\n  function atualizarLista(idAtual) {\n    setFileObjects(fileObjects.filter(el => el.id !== idAtual.id));\n    setContagem(fileObjects.filter(el => el.id !== idAtual.id)); //  setFileObjects(arraytoSend);\n  }\n\n  const FileList = ({\n    files\n  }) => /*#__PURE__*/_jsx(\"div\", {\n    children: /*#__PURE__*/_jsx(Container, {\n      children: files.map(uploadedFile => /*#__PURE__*/_jsxs(\"li\", {\n        children: [/*#__PURE__*/_jsxs(FileInfo, {\n          children: [/*#__PURE__*/_jsx(Preview, {\n            src: uploadedFile.preview\n          }), /*#__PURE__*/_jsxs(Box, {\n            className: classes.qtyLetras,\n            children: [/*#__PURE__*/_jsx(\"strong\", {\n              children: uploadedFile.name\n            }), /*#__PURE__*/_jsx(\"span\", {\n              children: uploadedFile.readableSize\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          children: [uploadedFile.progress > 0 && !uploadedFile.error ? /*#__PURE__*/_jsx(CircularProgressbar, {\n            styles: {\n              root: {\n                width: 30\n              },\n              path: {\n                stroke: '#7159c1'\n              }\n            },\n            strokeWidth: 10 // percentage={20on} // {uploadedFile.progress}\n            ,\n            value: uploadedFile.progress\n          }) : /*#__PURE__*/_jsx(DeleteForeverIcon, {\n            type: \"button\",\n            onClick: () => {\n              atualizarLista(uploadedFile);\n            },\n            style: {\n              color: 'red',\n              fontSize: 30\n            }\n          }), uploadedFile.url && /*#__PURE__*/_jsx(\"a\", {\n            href: \"https://sistemaidpb.s3.amazonaws.com/CAMPO%20GRANDE.png\",\n            target: \"_blank\",\n            rel: \"noopener noreferrer\",\n            children: /*#__PURE__*/_jsx(MdLink, {\n              styles: {\n                marginRight: 8\n              },\n              size: 24,\n              color: \"#222\"\n            })\n          }), uploadedFile.uploaded && /*#__PURE__*/_jsx(MdCheckCircle, {\n            size: 24,\n            color: \"#78e5d5\"\n          }), uploadedFile.error && /*#__PURE__*/_jsx(MdError, {\n            size: 24,\n            color: \"#e57878\"\n          })]\n        })]\n      }, uniqueId()))\n    })\n  });\n\n  const handleVoltar = e => {\n    setFileObjects(fileObjects.slice(fileObjects.indexOf(e.target.name, 1)));\n    setFileObjects(fileObjects.filter(x => x % 2));\n    setOpen(false);\n\n    if (!editar) {\n      setEditar(true);\n    } else {\n      setEditar(false);\n    }\n  };\n\n  const handleClose = () => {\n    setOpen(false);\n  }; //= ======================================================================\n  // Carregar AWS s3 com as fotos\n  //= ======================================================================\n\n\n  const updateFile = tempo => {\n    setProgresso(tempo);\n  };\n\n  const processUpload = uploadedFile => {\n    const dataFile = new FormData();\n    dataFile.append('file', uploadedFile.file, uploadedFile.name);\n    api.post('api/fotos', dataFile, {\n      onUploadProgress: e => {\n        const progress = Math.round(e.loaded * 100 / e.total);\n        updateFile(progress);\n        console.log(progress, e.total, e.loaded);\n      }\n    }).then(response => {\n      if (response) {\n        setTransfer(response.status);\n        setEditar(false);\n        console.log('response:', response.status);\n      } //  updateFile(uploadedFile.id, { uploaded: true });\n\n    }).catch(() => {//  updateFile(uploadedFile.id, { error: true });\n    });\n  };\n\n  const iniciarEnvio = async () => {\n    const uploadedFiles = fileObjects.map(file => ({\n      file,\n      id: uniqueId(),\n      name: `img${file.id}_${dataEvento}_${item[0].codigoIgreja}${file.name.substring(file.name.lastIndexOf('.'))}`,\n      readableSize: filesize(file.size),\n      preview: URL.createObjectURL(file),\n      progress: 0,\n      uploaded: false,\n      error: false,\n      url: null\n    }));\n    uploadedFiles.forEach(processUpload); // e.preventDefault();\n\n    setLoading(true);\n    setFileObjects(arrayFinal);\n  }; //= ======================================================================\n\n\n  const fileSend = () => {\n    setOpen(false);\n    iniciarEnvio();\n  };\n\n  function MyDropzone() {\n    const onDrop = useCallback(acceptedFiles => {\n      setFileObjects(acceptedFiles.map(file => Object.assign(file, {\n        preview: URL.createObjectURL(file),\n        id: uniqueId(),\n        readableSize: filesize(file.size),\n        progress: 0,\n        uploaded: false,\n        error: false,\n        url: null\n      })));\n      setFileObjects([].concat(fileObjects, acceptedFiles));\n      setContagem([].concat(contagem, acceptedFiles));\n    });\n    const {\n      getRootProps,\n      getInputProps,\n      isDragActive,\n      isDragReject\n    } = useDropzone({\n      onDrop,\n      accept: 'video/*'\n    });\n\n    const DragMessage = (a, b) => {\n      if (send) {\n        return /*#__PURE__*/_jsx(UploadMessage, {\n          children: /*#__PURE__*/_jsx(CheckCircleIcon, {\n            style: {\n              color: '#76ff03',\n              fontSize: 50\n            }\n          })\n        });\n      }\n\n      if (!a && !send) {\n        return /*#__PURE__*/_jsxs(UploadMessage, {\n          children: [/*#__PURE__*/_jsx(Button, {\n            children: /*#__PURE__*/_jsx(ImageSearchIcon, {\n              fontSize: \"large\",\n              style: {\n                color: 'black'\n              }\n            })\n          }), \"Pressione Aqui para Inserir o V\\xEDdeo\"]\n        });\n      }\n\n      if (b && !send) {\n        return /*#__PURE__*/_jsx(UploadMessage, {\n          type: \"error\",\n          children: \"Arquivo n\\xE3o suportado..\"\n        });\n      }\n\n      return /*#__PURE__*/_jsx(UploadMessage, {\n        type: \"success\",\n        children: \"Solte os arquivos aqui..\"\n      });\n    };\n\n    return /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(Dropzone, {\n        children: () => /*#__PURE__*/_jsxs(DropContainer, _objectSpread(_objectSpread({}, getRootProps({\n          onClick: event => {\n            if (send) {\n              event.stopPropagation();\n            }\n          }\n        })), {}, {\n          isDragActive: isDragActive,\n          isDragReject: isDragReject,\n          children: [/*#__PURE__*/_jsx(\"input\", _objectSpread({}, getInputProps())), DragMessage(isDragActive, isDragReject)]\n        }))\n      }), fileObjects.length > 0 && /*#__PURE__*/_jsx(FileList, {\n        files: fileObjects\n      })]\n    });\n  } // const [editar, setEditar] = React.useState(true);\n\n\n  const {\n    data,\n    error\n  } = useSWR(url, fetcher); // useSWR('/api/user', (id = 4) => fetcher(id));\n  // useSWR('/api/consultaDados', fetcher);\n\n  if (error) return /*#__PURE__*/_jsx(\"div\", {\n    children: \"Failed to load\"\n  });\n  if (!data) return /*#__PURE__*/_jsx(\"div\", {\n    children: \"Loading...\"\n  }); //---------------------------------------------------------------------------\n  //--------------------------------------------------------------------------\n\n  const handleModal = () => {\n    setTransfer('');\n    setOpen(true);\n    setSend(false);\n  }; //--------------------------------------------------------------------------\n  //--------------------------------------------------------------------------\n\n\n  function TelaEventos() {\n    return /*#__PURE__*/_jsx(Modal, {\n      open: open,\n      onClose: handleClose,\n      \"aria-labelledby\": \"simple-modal-title\",\n      \"aria-describedby\": \"simple-modal-description\",\n      children: /*#__PURE__*/_jsx(Box, {\n        className: classes.boxUp,\n        children: /*#__PURE__*/_jsxs(Box, {\n          className: classes.boxInterno,\n          children: [/*#__PURE__*/_jsx(MyDropzone, {}), /*#__PURE__*/_jsxs(Box, {\n            display: \"flex\",\n            flexDirection: \"row\",\n            justifyContent: \"space-around\",\n            mt: 2,\n            children: [/*#__PURE__*/_jsx(Button, {\n              variant: \"contained\",\n              size: \"small\",\n              onClick: handleVoltar,\n              className: classes.buttonCancel,\n              children: \"Cancelar\"\n            }), /*#__PURE__*/_jsx(Button, {\n              variant: \"contained\",\n              size: \"small\",\n              className: classes.buttonGreen,\n              onClick: fileSend,\n              disabled: !send,\n              children: \"Adicionar\"\n            })]\n          })]\n        })\n      })\n    });\n  }\n\n  function CircularProgressWithLabel() {\n    return /*#__PURE__*/_jsxs(Box, {\n      position: \"relative\",\n      display: \"inline-flex\",\n      children: [/*#__PURE__*/_jsx(CircularProgress, {\n        variant: \"determinate\",\n        value: progresso\n      }), /*#__PURE__*/_jsx(Box, {\n        top: 0,\n        left: 0,\n        bottom: 0,\n        right: 0,\n        position: \"absolute\",\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        children: /*#__PURE__*/_jsx(Typography, {\n          variant: \"caption\",\n          component: \"div\",\n          color: \"textSecondary\",\n          children: `${progresso}%`\n        })\n      })]\n    });\n  }\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [session ? /*#__PURE__*/_jsxs(Box, {\n      align: \"center\",\n      width: \"100%\",\n      children: [/*#__PURE__*/_jsx(Box, {\n        children: /*#__PURE__*/_jsxs(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          size: \"small\",\n          className: classes.button,\n          startIcon: !loading && /*#__PURE__*/_jsx(TouchAppIcon, {\n            style: {\n              fontSize: 40\n            }\n          }),\n          onClick: handleModal,\n          style: {\n            marginTop: 150\n          },\n          disabled: loading //  startIcon={<SaveIcon />}\n          ,\n          children: [!loading && 'Inserir Vídeo', progresso < 100 && loading && 'Carregando Vídeo...', progresso === 100 && transfer === '' && loading && 'Enviando Vídeo...']\n        })\n      }), /*#__PURE__*/_jsx(Box, {\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        mt: 10,\n        children: loading && transfer === '' && /*#__PURE__*/_jsx(CircularProgressWithLabel, {})\n      }), /*#__PURE__*/_jsx(Box, {\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        mt: 10,\n        children: /*#__PURE__*/_jsx(Typography, {\n          variant: \"caption\",\n          component: \"div\",\n          color: \"textSecondary\",\n          children: transfer === 200 && /*#__PURE__*/_jsx(Alert, {\n            action: /*#__PURE__*/_jsx(Button, {\n              onClick: () => {\n                setLoading(false);\n                setTransfer('');\n              },\n              color: \"inherit\",\n              size: \"small\",\n              children: /*#__PURE__*/_jsx(CancelIcon, {})\n            }),\n            children: \"V\\xEDdeo enviado com Sucesso!!!\"\n          })\n        })\n      })]\n    }) : signOut({\n      callbackUrl: `${window.location.origin}`\n    }), open && /*#__PURE__*/_jsx(TelaEventos, {})]\n  });\n}\n\nexport default enviar;","map":null,"metadata":{},"sourceType":"module"}