{"ast":null,"code":"import React, { useState } from 'react';\nimport aws from 'aws-sdk';\nvar region = process.env.AWSREGION;\nvar bucketName = 'sistemaidpb';\nvar accessKeyId = process.env.AWSACCESS_KEY;\nvar secretAccessKey = process.env.AWSSECRET_KEY;\naws.config.update({\n  secretAccessKey: process.env.AWSSECRET_KEY,\n  accessKeyId: process.env.AWSACCESS_KEY,\n  region: process.env.AWSREGION\n});\nvar s3 = new aws.S3({\n  region: region,\n  accessKeyId: accessKeyId,\n  secretAccessKey: secretAccessKey,\n  signatureVersion: 'v4'\n});\n\nvar downloadImg = function downloadImg() {\n  var params = {\n    Bucket: bucketName,\n    Key: 'ARACAJU.png'\n  };\n\n  var handleDownload = function handleDownload() {\n    console.log('lugar 1');\n\n    function downloadBlob(blob) {\n      var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"ARACAJU.png\";\n      // Convert your blob into a Blob URL (a special url that points to an object in the browser's memory)\n      var blobUrl = URL.createObjectURL(blob); // Create a link element\n\n      var link = document.createElement('a'); // Set link's href to point to the Blob URL\n\n      link.href = blobUrl;\n      link.download = name; // Append link to the body\n\n      document.body.appendChild(link); // Dispatch click event on the link\n      // This is necessary as link.click() does not work on the latest firefox\n\n      link.dispatchEvent(new MouseEvent('click', {\n        bubbles: true,\n        cancelable: true,\n        view: window\n      })); // Remove link from body\n\n      document.body.removeChild(link);\n    }\n\n    s3.getObjectMetadata('ARACAJU.png').promise().then(function () {\n      // This will not throw error anymore\n      s3.getObject().createReadStream();\n    })[\"catch\"](function (error) {\n      if (error.statusCode === 404) {// Catching NoSuchKey\n      }\n    });\n    s3.getObject(params, function (err, data) {\n      if (err) {\n        console.log('lugar 2- erro');\n        console.log(err, err.stack);\n      } else {\n        var csvBlob = new Blob([data.Body.toString()], {\n          type: 'text/csv;charset=utf-8;'\n        });\n        downloadBlob(csvBlob, \"ARACAJU.png\");\n      }\n    });\n  };\n\n  handleDownload();\n};\n\nexport default downloadImg;","map":{"version":3,"sources":["E:/src/next/sistemas/idpb-app/src/utils/downloadImage.js"],"names":["React","useState","aws","region","process","env","AWSREGION","bucketName","accessKeyId","AWSACCESS_KEY","secretAccessKey","AWSSECRET_KEY","config","update","s3","S3","signatureVersion","downloadImg","params","Bucket","Key","handleDownload","console","log","downloadBlob","blob","name","blobUrl","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","dispatchEvent","MouseEvent","bubbles","cancelable","view","window","removeChild","getObjectMetadata","promise","then","getObject","createReadStream","error","statusCode","err","data","stack","csvBlob","Blob","Body","toString","type"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\r\nimport aws from 'aws-sdk';\r\n\r\nconst region = process.env.AWSREGION;\r\nconst bucketName = 'sistemaidpb';\r\nconst accessKeyId = process.env.AWSACCESS_KEY;\r\nconst secretAccessKey = process.env.AWSSECRET_KEY;\r\n\r\naws.config.update({\r\n  secretAccessKey: process.env.AWSSECRET_KEY,\r\n  accessKeyId: process.env.AWSACCESS_KEY,\r\n  region: process.env.AWSREGION,\r\n});\r\n\r\nconst s3 = new aws.S3({\r\n  region,\r\n  accessKeyId,\r\n  secretAccessKey,\r\n  signatureVersion: 'v4',\r\n});\r\n\r\nconst downloadImg = () => {\r\n  const params = {\r\n    Bucket: bucketName,\r\n    Key: 'ARACAJU.png',\r\n  };\r\n  const handleDownload = () => {\r\n    console.log('lugar 1');\r\n\r\n    function downloadBlob(blob, name = `ARACAJU.png`) {\r\n      // Convert your blob into a Blob URL (a special url that points to an object in the browser's memory)\r\n      const blobUrl = URL.createObjectURL(blob);\r\n      // Create a link element\r\n      const link = document.createElement('a');\r\n      // Set link's href to point to the Blob URL\r\n      link.href = blobUrl;\r\n      link.download = name;\r\n      // Append link to the body\r\n      document.body.appendChild(link);\r\n      // Dispatch click event on the link\r\n      // This is necessary as link.click() does not work on the latest firefox\r\n      link.dispatchEvent(\r\n        new MouseEvent('click', {\r\n          bubbles: true,\r\n          cancelable: true,\r\n          view: window,\r\n        }),\r\n      );\r\n\r\n      // Remove link from body\r\n      document.body.removeChild(link);\r\n    }\r\n    s3.getObjectMetadata('ARACAJU.png')\r\n      .promise()\r\n      .then(() => {\r\n        // This will not throw error anymore\r\n        s3.getObject().createReadStream();\r\n      })\r\n      .catch((error) => {\r\n        if (error.statusCode === 404) {\r\n          // Catching NoSuchKey\r\n        }\r\n      });\r\n    s3.getObject(params, (err, data) => {\r\n      if (err) {\r\n        console.log('lugar 2- erro');\r\n        console.log(err, err.stack);\r\n      } else {\r\n        const csvBlob = new Blob([data.Body.toString()], {\r\n          type: 'text/csv;charset=utf-8;',\r\n        });\r\n        downloadBlob(csvBlob, `ARACAJU.png`);\r\n      }\r\n    });\r\n  };\r\n\r\n  handleDownload();\r\n};\r\n\r\nexport default downloadImg;\r\n"]},"metadata":{},"sourceType":"module"}