{"ast":null,"code":"import aws from 'aws-sdk'; // import crypto from 'crypto';\n// import { promisify } from 'util';\n\nimport { HttpRequest } from '@aws-sdk/protocol-http';\nimport { S3RequestPresigner } from '@aws-sdk/s3-request-presigner';\nimport { parseUrl } from '@aws-sdk/url-parser';\nimport { Sha256 } from '@aws-crypto/sha256-browser';\nimport { Hash } from '@aws-sdk/hash-node';\nimport { formatUrl } from '@aws-sdk/util-format-url';\nimport Iframe from 'react-iframe'; // const randomBytes = promisify(crypto.randomBytes);\n\nconst region = process.env.AWSREGION;\nconst bucketName = 'sistemaidpb';\nconst accessKeyId = process.env.AWSACCESS_KEY;\nconst secretAccessKey = process.env.AWSSECRET_KEY;\naws.config.update({\n  secretAccessKey: process.env.AWSSECRET_KEY,\n  accessKeyId: process.env.AWSACCESS_KEY,\n  region: process.env.AWSREGION\n});\nconst credentials = {\n  accessKeyId,\n  secretAccessKey,\n  signatureVersion: 'v4'\n};\nexport async function uploadVideosS3(fileName) {\n  // const rawBytes = await randomBytes(16);\n  // const imageName = rawBytes.toString('hex');\n  const params = {\n    Bucket: bucketName,\n    Key: fileName\n  };\n  const s3 = new aws.S3();\n  const valorUrl = s3.getObject({\n    params\n  }, (error, data) => {\n    if (error != null) {\n      console.log(`Failed to retrieve an object: ${error}`);\n    } else {\n      console.log(`Loaded ${data.ContentLength} bytes`); // do something with data.Body\n    }\n  }).promise; // pergar URL DO bucket\n  // const uploadURL = await s3.getSignedUrlPromise('putObject', params);\n\n  const s3ObjectUrl = parseUrl(`https://${bucketName}.s3.${region}.amazonaws.com/${fileName}`);\n  const presigner = new S3RequestPresigner({\n    credentials,\n    region,\n    // sha256: Hash.bind(null, 'sha256'), // In Node.js\n    sha256: Sha256 // In browsers\n\n  }); // Create a GET request from S3 url.\n\n  console.log('filenName', fileName);\n  const uploadURL = await presigner.presign(new HttpRequest(s3ObjectUrl));\n  const urls = uploadURL;\n  console.log(urls); // pegar a lista do bucket\n\n  /*   const uploadURL = await s3\r\n    .listObjectsV2({\r\n      Bucket: bucketName,\r\n    })\r\n    .promise();\r\n  */\n\n  return urls;\n}\nexport default uploadVideosS3;","map":{"version":3,"sources":["E:/src/next/sistemas/idpb-app/src/utils/uploadImagensS3.js"],"names":["aws","HttpRequest","S3RequestPresigner","parseUrl","Sha256","Hash","formatUrl","Iframe","region","process","env","AWSREGION","bucketName","accessKeyId","AWSACCESS_KEY","secretAccessKey","AWSSECRET_KEY","config","update","credentials","signatureVersion","uploadVideosS3","fileName","params","Bucket","Key","s3","S3","valorUrl","getObject","error","data","console","log","ContentLength","promise","s3ObjectUrl","presigner","sha256","uploadURL","presign","urls"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,SAAhB,C,CACA;AACA;;AAEA,SAASC,WAAT,QAA4B,wBAA5B;AACA,SAASC,kBAAT,QAAmC,+BAAnC;AACA,SAASC,QAAT,QAAyB,qBAAzB;AACA,SAASC,MAAT,QAAuB,4BAAvB;AACA,SAASC,IAAT,QAAqB,oBAArB;AACA,SAASC,SAAT,QAA0B,0BAA1B;AACA,OAAOC,MAAP,MAAmB,cAAnB,C,CAEA;;AAEA,MAAMC,MAAM,GAAGC,OAAO,CAACC,GAAR,CAAYC,SAA3B;AACA,MAAMC,UAAU,GAAG,aAAnB;AACA,MAAMC,WAAW,GAAGJ,OAAO,CAACC,GAAR,CAAYI,aAAhC;AACA,MAAMC,eAAe,GAAGN,OAAO,CAACC,GAAR,CAAYM,aAApC;AAEAhB,GAAG,CAACiB,MAAJ,CAAWC,MAAX,CAAkB;AAChBH,EAAAA,eAAe,EAAEN,OAAO,CAACC,GAAR,CAAYM,aADb;AAEhBH,EAAAA,WAAW,EAAEJ,OAAO,CAACC,GAAR,CAAYI,aAFT;AAGhBN,EAAAA,MAAM,EAAEC,OAAO,CAACC,GAAR,CAAYC;AAHJ,CAAlB;AAMA,MAAMQ,WAAW,GAAG;AAClBN,EAAAA,WADkB;AAElBE,EAAAA,eAFkB;AAGlBK,EAAAA,gBAAgB,EAAE;AAHA,CAApB;AAMA,OAAO,eAAeC,cAAf,CAA8BC,QAA9B,EAAwC;AAC7C;AACA;AAEA,QAAMC,MAAM,GAAG;AACbC,IAAAA,MAAM,EAAEZ,UADK;AAEba,IAAAA,GAAG,EAAEH;AAFQ,GAAf;AAIA,QAAMI,EAAE,GAAG,IAAI1B,GAAG,CAAC2B,EAAR,EAAX;AACA,QAAMC,QAAQ,GAAGF,EAAE,CAACG,SAAH,CAAa;AAAEN,IAAAA;AAAF,GAAb,EAAyB,CAACO,KAAD,EAAQC,IAAR,KAAiB;AACzD,QAAID,KAAK,IAAI,IAAb,EAAmB;AACjBE,MAAAA,OAAO,CAACC,GAAR,CAAa,iCAAgCH,KAAM,EAAnD;AACD,KAFD,MAEO;AACLE,MAAAA,OAAO,CAACC,GAAR,CAAa,UAASF,IAAI,CAACG,aAAc,QAAzC,EADK,CAEL;AACD;AACF,GAPgB,EAOdC,OAPH,CAT6C,CAkB7C;AACA;;AAEA,QAAMC,WAAW,GAAGjC,QAAQ,CACzB,WAAUS,UAAW,OAAMJ,MAAO,kBAAiBc,QAAS,EADnC,CAA5B;AAIA,QAAMe,SAAS,GAAG,IAAInC,kBAAJ,CAAuB;AACvCiB,IAAAA,WADuC;AAEvCX,IAAAA,MAFuC;AAGvC;AACA8B,IAAAA,MAAM,EAAElC,MAJ+B,CAIvB;;AAJuB,GAAvB,CAAlB,CAzB6C,CAgC7C;;AACA4B,EAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBX,QAAzB;AACA,QAAMiB,SAAS,GAAG,MAAMF,SAAS,CAACG,OAAV,CAAkB,IAAIvC,WAAJ,CAAgBmC,WAAhB,CAAlB,CAAxB;AACA,QAAMK,IAAI,GAAGF,SAAb;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYQ,IAAZ,EApC6C,CAsC7C;;AACA;AACF;AACA;AACA;AACA;AACA;;AAAI,SAAOA,IAAP;AACH;AAED,eAAepB,cAAf","sourcesContent":["import aws from 'aws-sdk';\r\n// import crypto from 'crypto';\r\n// import { promisify } from 'util';\r\n\r\nimport { HttpRequest } from '@aws-sdk/protocol-http';\r\nimport { S3RequestPresigner } from '@aws-sdk/s3-request-presigner';\r\nimport { parseUrl } from '@aws-sdk/url-parser';\r\nimport { Sha256 } from '@aws-crypto/sha256-browser';\r\nimport { Hash } from '@aws-sdk/hash-node';\r\nimport { formatUrl } from '@aws-sdk/util-format-url';\r\nimport Iframe from 'react-iframe';\r\n\r\n// const randomBytes = promisify(crypto.randomBytes);\r\n\r\nconst region = process.env.AWSREGION;\r\nconst bucketName = 'sistemaidpb';\r\nconst accessKeyId = process.env.AWSACCESS_KEY;\r\nconst secretAccessKey = process.env.AWSSECRET_KEY;\r\n\r\naws.config.update({\r\n  secretAccessKey: process.env.AWSSECRET_KEY,\r\n  accessKeyId: process.env.AWSACCESS_KEY,\r\n  region: process.env.AWSREGION,\r\n});\r\n\r\nconst credentials = {\r\n  accessKeyId,\r\n  secretAccessKey,\r\n  signatureVersion: 'v4',\r\n};\r\n\r\nexport async function uploadVideosS3(fileName) {\r\n  // const rawBytes = await randomBytes(16);\r\n  // const imageName = rawBytes.toString('hex');\r\n\r\n  const params = {\r\n    Bucket: bucketName,\r\n    Key: fileName,\r\n  };\r\n  const s3 = new aws.S3();\r\n  const valorUrl = s3.getObject({ params }, (error, data) => {\r\n    if (error != null) {\r\n      console.log(`Failed to retrieve an object: ${error}`);\r\n    } else {\r\n      console.log(`Loaded ${data.ContentLength} bytes`);\r\n      // do something with data.Body\r\n    }\r\n  }).promise;\r\n\r\n  // pergar URL DO bucket\r\n  // const uploadURL = await s3.getSignedUrlPromise('putObject', params);\r\n\r\n  const s3ObjectUrl = parseUrl(\r\n    `https://${bucketName}.s3.${region}.amazonaws.com/${fileName}`,\r\n  );\r\n\r\n  const presigner = new S3RequestPresigner({\r\n    credentials,\r\n    region,\r\n    // sha256: Hash.bind(null, 'sha256'), // In Node.js\r\n    sha256: Sha256, // In browsers\r\n  });\r\n\r\n  // Create a GET request from S3 url.\r\n  console.log('filenName', fileName);\r\n  const uploadURL = await presigner.presign(new HttpRequest(s3ObjectUrl));\r\n  const urls = uploadURL;\r\n  console.log(urls);\r\n\r\n  // pegar a lista do bucket\r\n  /*   const uploadURL = await s3\r\n    .listObjectsV2({\r\n      Bucket: bucketName,\r\n    })\r\n    .promise();\r\n */ return urls;\r\n}\r\n\r\nexport default uploadVideosS3;\r\n"]},"metadata":{},"sourceType":"module"}